# 세션 핸드오프
ts: 2026-01-13 19:30
from_session: "예약 시스템 Wave 1-5 구현 완료"

## 마지막 작업
task: "예약 시스템 Wave 1-5 전체 구현"
result: "완료 - Types, Actions, Services, Hooks, Contexts, Components, Pages"

## 진행중 작업 (WIP)
wip:
  - "없음 - Wave 1-5 모두 완료"

## 완료된 작업
completed:
  - "예약 시스템 PRD, RFC, Orchestration 문서 작성"
  - "Wave 1: 타입 정의 (src/types/booking.ts)"
  - "Wave 1: Server Actions (src/app/actions/uncle.ts, booking.ts)"
  - "Wave 1: Security Rules 업데이트 (firestore.rules)"
  - "Wave 2: Services (src/services/uncleService.ts, bookingService.ts)"
  - "Wave 2: Hooks (src/hooks/useBooking.ts, useBookingForm.ts)"
  - "Wave 2: Context (src/contexts/BookingContext.tsx)"
  - "Wave 3: UI Components (UncleCard, UncleList, BookingCard, BookingList, BookingForm, BookingStepIndicator)"
  - "Wave 4: Pages (/uncles, /uncles/[id], /uncles/[id]/book, /bookings, /bookings/[id])"
  - "Wave 5: 빌드 검증, Lint 검사, Layout 수정 통과"
  - "TypeScript 컴파일 성공, Lint 통과, 빌드 성공"

## 미결 사항
pending:
  - "Firebase Storage 설정 필요 (Console에서 'Get Started' 클릭)"
  - "Storage 규칙 배포 (Storage 설정 후)"
  - "firestore.rules 재배포 필요 (bookings, uncle_bank_accounts 규칙 추가됨)"
  - "E2E 테스트 작성 (선택적)"
  - "실제 데이터로 통합 테스트 (Firestore에 테스트 데이터 필요)"

## 대화 맥락
context:
  - "예약 시스템 = 아조씨 목록 + 예약 요청/관리 (통합 개발)"
  - "온라인 결제 연동은 후속 Phase로 연기"
  - "현재는 오프라인 결제 안내 (현장/계좌이체)"
  - "복잡도 5.8 → 5 Wave 구조로 개발"
  - "Wave 1-5 모두 완료"

---

## Wave 진행 상황

| Wave | 내용 | 상태 | 결과 |
|------|------|------|------|
| Wave 1 | Foundation (Types, Actions, Rules) | ✅ 완료 | 타입, Server Actions, Firestore Rules |
| Wave 2 | Core Logic (Services, Hooks, Context) | ✅ 완료 | Services, Custom Hooks, BookingContext |
| Wave 3 | UI Components | ✅ 완료 | 6개 컴포넌트 (Card, List, Form, Indicator) |
| Wave 4 | Pages & Integration | ✅ 완료 | 5개 페이지 (uncles, bookings) |
| Wave 5 | QA & Polish | ✅ 완료 | 빌드 성공, Lint 통과 |

---

## 구현 산출물

### Wave 1 - Foundation
```
src/types/booking.ts
- BookingStatus, ServiceType, LocationType 타입
- Booking, BookingListItem, UncleListItem, UncleDetail 인터페이스
- API 응답 타입 (GetUnclesResponse, CreateBookingResponse 등)
- 상수 (TIME_SLOTS, SERVICE_LABELS, LOCATION_LABELS 등)

src/app/actions/uncle.ts
- getUncles(): 승인된 아조씨 목록 조회
- getUncleById(): 아조씨 상세 조회

src/app/actions/booking.ts
- createBooking(): 예약 요청 생성
- getBookings(): 예약 목록 조회
- getBookingById(): 예약 상세 조회
- acceptBooking(): 예약 수락 (아조씨)
- rejectBooking(): 예약 거절 (아조씨)
- cancelBooking(): 예약 취소 (고객/아조씨)
- startBooking(): 서비스 시작
- completeBooking(): 서비스 완료

firestore.rules
- uncles: 승인된 아조씨는 공개 조회 가능
- bookings: 본인(고객/아조씨)만 읽기/쓰기
- uncle_bank_accounts: 공개된 경우 누구나, 비공개면 본인만
```

### Wave 2 - Core Logic
```
src/services/uncleService.ts
- getUncles(): Server Action 래퍼
- getUncleById(): Server Action 래퍼

src/services/bookingService.ts
- createBooking(): 예약 생성 래퍼
- getBookings(): 예약 목록 래퍼
- getBookingById(): 예약 상세 래퍼
- acceptBooking(), rejectBooking(), cancelBooking()
- startBooking(), completeBooking()

src/hooks/useBooking.ts
- useBookings(): 예약 목록 + 무한스크롤 + 상태필터
- useBookingDetail(): 예약 상세 + 액션들

src/hooks/useBookingForm.ts
- useBookingForm(): 폼 상태 관리 + 유효성 검사
- getAvailableDateRange(): 예약 가능 날짜 범위

src/contexts/BookingContext.tsx
- BookingProvider: 7단계 예약 플로우 상태 관리
- useBookingContext(): 예약 컨텍스트 훅

src/hooks/index.ts - barrel export
src/contexts/index.ts - barrel export
```

### Wave 3 - UI Components
```
src/components/booking/UncleCard.tsx
- UncleCard: 아조씨 카드 (default/compact variant)
- UncleCardSkeleton: 로딩 스켈레톤

src/components/booking/UncleList.tsx
- UncleList: 아조씨 목록 + 무한스크롤 + 그리드/리스트

src/components/booking/BookingCard.tsx
- BookingCard: 예약 카드 (상태별 액션 버튼)
- BookingCardSkeleton: 로딩 스켈레톤

src/components/booking/BookingList.tsx
- BookingList: 예약 목록 + 상태 필터 탭 + 무한스크롤

src/components/booking/BookingForm.tsx
- BookingForm: 3단계 예약 폼 (날짜→서비스→확인)

src/components/booking/BookingStepIndicator.tsx
- BookingStepIndicator: 스텝 인디케이터
- SimpleProgressBar: 간단한 진행 바

src/components/booking/index.ts - barrel export
```

### Wave 4 - Pages
```
src/app/(main)/layout.tsx
- AuthProvider 래퍼 (SSG/SSR 지원)

src/app/(main)/uncles/page.tsx
- 아조씨 목록 페이지 (공개)

src/app/(main)/uncles/[id]/page.tsx
- 아조씨 상세 페이지 (프로필, 가능시간, 예약버튼)

src/app/(main)/uncles/[id]/book/page.tsx
- 예약 생성 페이지 (로그인 필요)

src/app/(main)/bookings/page.tsx
- 예약 목록 페이지 (로그인 필요, 상태별 필터)

src/app/(main)/bookings/[id]/page.tsx
- 예약 상세 페이지 (상태별 액션 버튼)
```

### Wave 5 - QA
```
빌드 결과:
Route (app)                              Size     First Load JS
├ ○ /bookings                            3.56 kB         217 kB
├ ƒ /bookings/[id]                       4.58 kB         209 kB
├ ○ /uncles                              219 B           213 kB
├ ƒ /uncles/[id]                         3.65 kB         105 kB
└ ƒ /uncles/[id]/book                    3.29 kB         216 kB

수정 사항:
- ESLint 규칙 오류 수정
- SSG prerender 오류 → (main)/layout.tsx에 AuthProvider 추가
- react-hooks/exhaustive-deps 경고 처리
```

---

## 스펙 변경 요약 (v5.9)

### 1. 아조씨 탐색/검색 기능 간소화
- **변경 전**: 복잡한 검색 필터 (지역/가격/평점/시간 등)
- **변경 후**: 간단한 아조씨 목록만 제공
- **방식**: 고객이 목록에서 직접 아조씨 선택 → 예약

### 2. 다국어 지원(i18n) 제거
- **변경 전**: Phase 2에서 영어 지원 예정
- **변경 후**: 스펙에서 완전 제거
- **결정**: 한국어 단일 언어 서비스

### 3. 리뷰/평점 시스템 → 당근 스타일 매너온도
- **변경 전**: 5성 평점 + 텍스트 리뷰 (공개)
- **변경 후**: 당근 스타일 매너온도 (비공개)
  - 기본 온도: 36.5°C
  - 거래 완료 후 매너 평가로 온도 변동 (-0.5 ~ +0.5)
  - **아조씨 본인만** 자신의 매너온도 확인 가능

### 4. 온라인 결제 연동 → 후속 Phase로 연기
- **변경 전**: Toss Payments 에스크로우 연동 (이번 Phase)
- **변경 후**: 오프라인 결제 안내
  - 예약 확정 시 "결제는 서비스 당일 현장에서 처리" 안내
  - 계좌이체 또는 현금 결제

---

## Firebase 배포 정보

```yaml
hosting_url: https://azrental-842a8.web.app
project_id: azrental-842a8
region: asia-northeast3 (Seoul)

deployed:
  - firestore.rules ✅ (업데이트 필요)
  - hosting ✅

pending:
  - firestore.rules 재배포 (bookings, uncle_bank_accounts 규칙 추가)
  - storage.rules (Storage 설정 필요)
```

---

## 다음 세션 권장 작업
next_action: "통합 테스트 또는 다음 Feature Hub 진행"
tasks:
  - "Firestore에 테스트 아조씨 데이터 추가"
  - "실제 예약 플로우 E2E 테스트"
  - "firestore.rules 재배포"
  - "다음 Feature Hub 선택 (메시지/알림/결제 등)"

read_first:
  - "CLAUDE.md"
  - ".handoff.md (이 파일)"

---

## 문서 위치

```yaml
booking_system:
  prd: docs/feature-hubs/booking-system/01-PRD.md
  rfc: docs/feature-hubs/booking-system/03-RFC.md
  orchestration: docs/feature-hubs/booking-system/04-ORCHESTRATION.md

types: src/types/booking.ts

actions:
  uncle: src/app/actions/uncle.ts
  booking: src/app/actions/booking.ts

services:
  uncle: src/services/uncleService.ts
  booking: src/services/bookingService.ts

hooks:
  booking: src/hooks/useBooking.ts
  bookingForm: src/hooks/useBookingForm.ts
  index: src/hooks/index.ts

contexts:
  booking: src/contexts/BookingContext.tsx
  index: src/contexts/index.ts

components:
  uncleCard: src/components/booking/UncleCard.tsx
  uncleList: src/components/booking/UncleList.tsx
  bookingCard: src/components/booking/BookingCard.tsx
  bookingList: src/components/booking/BookingList.tsx
  bookingForm: src/components/booking/BookingForm.tsx
  bookingStepIndicator: src/components/booking/BookingStepIndicator.tsx
  index: src/components/booking/index.ts

pages:
  mainLayout: src/app/(main)/layout.tsx
  uncles: src/app/(main)/uncles/page.tsx
  uncleDetail: src/app/(main)/uncles/[id]/page.tsx
  uncleBook: src/app/(main)/uncles/[id]/book/page.tsx
  bookings: src/app/(main)/bookings/page.tsx
  bookingDetail: src/app/(main)/bookings/[id]/page.tsx
```
