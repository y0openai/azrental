# 01-PRD.md - 예약 시스템 (Booking System)

> **Product Requirements Document**
> **작성일**: 2026-01-13
> **작성자**: Orchestrator Agent
> **상태**: Draft

---

## 1. 개요 (Overview)

### 1.1 기능 요약
> 고객이 아조씨 목록에서 직접 선택하여 예약 요청하고, 아조씨가 수락하면 서비스가 진행되는 시스템 (결제는 오프라인/현장/계좌이체로 별도 처리)

### 1.2 배경 및 목적

- **문제점**: 현재 회원가입만 가능하고 실제 서비스 이용(예약)이 불가능
- **기회**: 예약 시스템을 통해 고객-아조씨 연결 가능
- **목표**: 간단하고 직관적인 예약 플로우 구축 (결제 연동은 후속 Phase)

### 1.3 성공 지표 (Success Metrics)

| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|----------|
| 예약 요청률 | N/A | 70% | 아조씨 상세 → 예약 요청 비율 |
| 아조씨 수락률 | N/A | 80% | 수락 건수 / 전체 요청 |
| 예약 취소율 | N/A | <15% | 취소 건수 / 전체 예약 |
| 서비스 완료율 | N/A | 85% | 완료 상태 예약 비율 |

---

## 2. 사용자 스토리 (User Stories)

### 2.1 주요 사용자

- **고객 (Customer)**: 아조씨 서비스를 이용하고 싶은 사람
- **아조씨 (Uncle)**: 서비스를 제공하는 중년 남성
- **관리자 (Admin)**: 분쟁 처리 및 시스템 운영

### 2.2 사용자 스토리

#### 스토리 1: 고객 - 아조씨 선택 및 예약
```
AS A 고객
I WANT 아조씨 목록에서 원하는 아조씨를 선택하여 예약하고
SO THAT 아조씨와 의미 있는 시간을 가질 수 있다
```
- **사용자**: 서비스가 필요한 고객
- **행동**: 아조씨 목록 확인 → 아조씨 선택 → 예약 폼 작성 → 결제
- **결과**: 선택한 아조씨에게 예약 요청이 전달됨

#### 스토리 2: 아조씨 - 예약 수락
```
AS A 아조씨
I WANT 들어온 예약 요청을 확인하고 수락/거절하고
SO THAT 내 스케줄에 맞는 예약만 진행할 수 있다
```
- **사용자**: 승인된 아조씨
- **행동**: 예약 요청 확인 → 수락/거절 → 고객과 소통
- **결과**: 예약 확정 및 서비스 준비

#### 스토리 3: 고객 - 서비스 완료 후 평가
```
AS A 고객
I WANT 서비스 완료 후 매너 평가를 하고
SO THAT 아조씨의 서비스 품질 향상에 기여할 수 있다
```
- **사용자**: 서비스를 받은 고객
- **행동**: 서비스 완료 확인 → 매너 평가 작성
- **결과**: 아조씨 매너온도 반영

---

## 3. 기능 요구사항 (Functional Requirements)

### 3.1 필수 기능 (Must Have)

#### 아조씨 목록 (고객)
- [ ] 승인된 아조씨 목록 표시 (간단한 그리드/리스트)
- [ ] 아조씨 카드: 프로필 사진, 이름, 한 줄 소개, 시간당 요금
- [ ] 아조씨 상세 프로필 페이지
  - [ ] 프로필 사진 (최대 5장)
  - [ ] 자기소개, 제공 서비스, 경력
  - [ ] 시간당 요금
  - [ ] 가용 시간 (캘린더)
- [ ] "예약하기" 버튼 → 예약 폼으로 이동

#### 예약 요청 (고객)
- [ ] 서비스 종류 선택 (잡담, 조언, 동행 등 12종)
- [ ] 희망 날짜/시간 선택 (캘린더 UI)
- [ ] 이용 시간 선택 (1~4시간)
- [ ] 만남 장소 유형 선택 (카페/공원/온라인/고객위치)
- [ ] 요청사항 입력 (500자 제한)
- [ ] 예상 금액 표시 (시간당 요금 기준)

#### 결제 안내 (오프라인 처리)
> ⚠️ **참고**: 온라인 결제 연동은 후속 Phase에서 구현합니다. 현재는 오프라인 결제로 안내합니다.

- [ ] 예약 확정 시 결제 안내 메시지 표시
  - "결제는 서비스 당일 현장에서 직접 처리해주세요"
  - "계좌이체 또는 현금 결제 가능"
- [ ] 예상 금액 표시 (시간당 요금 × 이용시간)
- [ ] 아조씨 계좌정보 표시 (선택적)

#### 예약 관리
- [ ] 예약 상태 관리: pending → confirmed → in_progress → completed/cancelled
- [ ] 예약 목록 조회 (고객/아조씨 각각)
- [ ] 예약 상세 조회
- [ ] 예약 취소
  - 24시간 전: 자유롭게 취소
  - 24시간 이내: 상대방에게 알림 후 취소

#### 아조씨 수락/거절
- [ ] 받은 예약 요청 확인
- [ ] 수락/거절 선택
- [ ] 거절 사유 입력 (선택)
- [ ] 수락 시 예약 확정

#### 서비스 완료 처리
- [ ] 아조씨: "서비스 완료" 버튼
- [ ] 고객: "서비스 확인" 버튼 (24시간 내)
- [ ] 자동 확인: 24시간 후 자동 완료 처리
- [ ] 매너 평가 요청 알림

### 3.2 권장 기능 (Should Have)

- [ ] 예약 리마인더 알림 (1일 전, 1시간 전)
- [ ] 예약 캘린더 뷰 (고객/아조씨)
- [ ] 반복 예약 (같은 아조씨 재예약)
- [ ] 예약 변경 (날짜/시간 수정)

### 3.3 선택 기능 (Nice to Have) - 후속 Phase

- [ ] **온라인 결제 연동 (Toss Payments)**
- [ ] **에스크로우 시스템**
- [ ] **정산 자동화**
- [ ] 예약 대기열 (선호 아조씨 지정)
- [ ] 긴급 예약 (당일 예약)
- [ ] 패키지 예약 (3회, 5회, 10회)

---

## 4. 비기능 요구사항 (Non-Functional Requirements)

### 4.1 성능
- 예약 목록 로딩: 1초 이내
- 아조씨 목록 로딩: 1초 이내
- 예약 요청 처리: 2초 이내

### 4.2 보안
- HTTPS 강제
- Firebase Security Rules 적용
- 개인정보 최소 수집

### 4.3 접근성
- 모바일 최적화
- 버튼 최소 크기 48px
- 색상 대비 4.5:1 이상

---

## 5. UI/UX 요구사항

### 5.1 화면 목록

| 화면명 | 설명 | 우선순위 |
|-------|------|---------|
| 아조씨 목록 | 승인된 아조씨 그리드/리스트 | High |
| 아조씨 상세 | 프로필 + 예약하기 버튼 | High |
| 예약 요청 폼 | 서비스/날짜/시간/장소 선택 | High |
| 예약 완료 | 예약 요청 완료 안내 + 결제 안내 | High |
| 예약 목록 (고객) | 내 예약 현황 | High |
| 예약 목록 (아조씨) | 받은 예약 요청 | High |
| 예약 상세 | 예약 정보 + 상태 + 결제 안내 | High |

### 5.2 User Flow

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 아조씨 목록  │ ──▶ │ 아조씨 선택  │ ──▶ │  예약 폼   │
│  (그리드)   │     │  (상세보기)  │     │   작성     │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
                                              ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  서비스     │ ◀── │  예약 확정   │ ◀── │ 예약 요청   │
│  진행       │     │ (아조씨 수락)│     │  완료      │
└─────────────┘     └─────────────┘     └─────────────┘
      │                                       │
      │                              (오프라인 결제 안내)
      ▼
┌─────────────┐     ┌─────────────┐
│  서비스     │ ──▶ │  매너 평가   │
│  완료       │     │  (고객)     │
└─────────────┘     └─────────────┘
```

### 5.3 예약 요청 폼 (Multi-Step)

**Step 1: 서비스 선택**
- 12개 서비스 카드 그리드
- 복수 선택 가능

**Step 2: 날짜/시간**
- 캘린더 (최소 1일 후)
- 시간 슬롯 (09:00 ~ 21:00, 1시간 단위)
- 이용 시간 선택 (1~4시간)

**Step 3: 장소**
- 장소 유형: 카페/공원/온라인/고객위치
- 고객위치 선택 시 주소 입력 (Kakao API)
- 선호 지역 (시/구)

**Step 4: 요청사항**
- 텍스트 입력 (500자)
- 예: "취업 면접 준비 중입니다. 모의 면접 부탁드려요"

**Step 5: 확인 및 요청**
- 예약 정보 요약
- 예상 금액 표시 (시간당 요금 × 이용시간)
- "예약 요청하기" 버튼
- 결제 안내: "결제는 서비스 당일 현장에서 처리됩니다"

---

## 6. 예약 상태 흐름 (State Machine)

```
┌──────────┐
│ pending  │ ← 고객이 예약 요청 (아조씨 응답 대기)
└────┬─────┘
     │ 아조씨 수락/거절
     ├───────────────┐
     ▼               ▼
┌──────────┐   ┌──────────┐
│confirmed │   │cancelled │ ← 거절됨
└────┬─────┘   └──────────┘
     │ 서비스 시작 시간
     ▼
┌───────────┐
│in_progress│ ← 서비스 진행 중
└────┬──────┘
     │ 아조씨 "완료" + 고객 "확인"
     ▼
┌──────────┐
│completed │ ← 매너 평가 요청
└──────────┘
```

---

## 7. 결제 안내 (오프라인 처리)

> ⚠️ **참고**: 온라인 결제 연동은 후속 Phase에서 구현합니다.

```
현재 버전 결제 흐름:

1. 예약 요청 완료
   └─▶ 예상 금액 안내 (시간당 요금 × 이용시간)

2. 예약 확정 (아조씨 수락)
   └─▶ 결제 안내 메시지 표시
       "결제는 서비스 당일 현장에서 직접 처리해주세요"
       "계좌이체 또는 현금 결제 가능합니다"

3. 서비스 완료
   └─▶ 매너 평가 요청
```

### 후속 Phase 계획 (온라인 결제)
- Toss Payments 연동
- 에스크로우 시스템
- 자동 정산

---

## 8. 제약사항 및 의존성

### 8.1 기술적 제약
- Firebase 프로젝트 설정 완료 필요
- Cloud Functions 배포 환경

### 8.2 외부 의존성
- **Kakao 주소 API**: 장소 입력
- **Firebase FCM**: 알림

### 8.3 후속 Phase 의존성 (온라인 결제)
- Toss Payments 가맹점 등록
- 에스크로우 서비스 신청
- 심사 기간: 영업일 1~2주

---

## 9. 범위 외 (Out of Scope)

> 이번 버전에서 **하지 않을** 것들

- **온라인 결제 연동** (Toss Payments)
- **에스크로우 시스템**
- **자동 정산**
- 구독/패키지 결제
- 포인트/쿠폰 시스템
- 자동 매칭 (AI 추천)

---

## 10. 데이터 스키마 (신규/수정)

### 10.1 bookings (수정)
```typescript
interface Booking {
  bookingId: string;           // 자동 생성
  customerId: string;          // users.uid
  uncleId: string;             // users.uid (선택한 아조씨)

  // 예약 정보
  services: string[];          // 서비스 종류 (복수)
  requestedDate: Timestamp;    // 희망 날짜
  requestedTime: string;       // 희망 시간 (HH:mm)
  duration: number;            // 이용 시간 (1~4)
  locationType: 'cafe' | 'park' | 'online' | 'customer_location';
  locationAddress?: string;    // 상세 주소
  preferredArea: string;       // 선호 지역 (시/구)
  customerNote: string;        // 요청사항

  // 금액 (참고용)
  hourlyRate: number;          // 시간당 요금
  estimatedPrice: number;      // 예상 금액

  // 상태
  status: 'pending' | 'confirmed' | 'in_progress' | 'completed' | 'cancelled';
  cancelReason?: string;
  cancelledBy?: 'customer' | 'uncle';

  // 타임스탬프
  createdAt: Timestamp;
  confirmedAt?: Timestamp;
  completedAt?: Timestamp;
  cancelledAt?: Timestamp;
}
```

### 10.2 uncle_bank_accounts (선택적 - 결제 안내용)
```typescript
interface UncleBankAccount {
  uid: string;                 // users.uid
  bankName: string;            // 은행명
  accountNumber: string;       // 계좌 번호 (표시용)
  accountHolder: string;       // 예금주
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

> 💡 **참고**: 정산(settlements) 관련 스키마는 온라인 결제 연동 시 추가됩니다.

---

## 11. API 엔드포인트 (Cloud Functions)

### 11.1 예약 관련
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/bookings` | 예약 요청 생성 |
| GET | `/bookings` | 예약 목록 조회 |
| GET | `/bookings/:id` | 예약 상세 조회 |
| PATCH | `/bookings/:id/cancel` | 예약 취소 |
| PATCH | `/bookings/:id/complete` | 서비스 완료 (아조씨) |
| PATCH | `/bookings/:id/confirm` | 서비스 확인 (고객) |

### 11.2 아조씨 목록/상세
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/uncles` | 승인된 아조씨 목록 |
| GET | `/uncles/:id` | 아조씨 상세 프로필 |

### 11.3 아조씨 수락/거절
| Method | Endpoint | 설명 |
|--------|----------|------|
| PATCH | `/uncle/bookings/:id/accept` | 예약 수락 |
| PATCH | `/uncle/bookings/:id/reject` | 예약 거절 |

> 💡 **참고**: 결제/정산 API는 온라인 결제 연동 시 추가됩니다.

---

## 12. 승인

| 역할 | 이름 | 승인 일자 | 서명 |
|------|------|----------|------|
| PM | | | |
| Tech Lead | | | |

---

*문서 버전: 1.0*
*최종 수정: 2026-01-13*
